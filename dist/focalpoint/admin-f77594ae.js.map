{"version":3,"sources":["webpack:///./node_modules/@wpackio/entrypoint/lib/index.js","webpack:///./assets/scripts/focalpoint.js"],"names":["path","replace","window","concat","$","win","doc","maxRange","val1","val2","val3","result","CLASSES","imageFocal","focalPoint","el","options","$imageFocal","$clickArea","self","this","$el","data","init","extend","defaultOptions","addInterfaceElements","attachment","focusInterface","saveButton","on","updateDimensionData","addClass","wrap","$focalWrapper","append","id","width","height","offset","x","y","getData","load","find","ajax","type","url","ajaxurl","action","dataType","always","undefined","Error","err","console","log","updateStylePosition","css","display","updateStyleBackground","left","top","radius","position","clickPosition","state","move","active","hover","e","which","startMove","removeClass","updateStyle","t","updateClickPosition","highlight","a","pos","pageX","pageY","backgroundImage","attr","backgroundSize","backgroundPosition","o","val","toggleClass","isSaving","button","focalPointL10n","sendImageCropDataByAjax","text","activate","disable","beforeSend","saving","msg","saved","success","tryAgain","myDefaultValue","fn","initFocalPoint","each","setInterval","length","jQuery","document"],"mappings":"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","file":"focalpoint/admin-f77594ae.js","sourcesContent":["/* eslint-disable camelcase */ /* eslint-disable babel/camelcase */ /* eslint-disable no-underscore-dangle */ // eslint-disable-next-line no-unused-vars\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\n/* global __webpack_public_path__ */ // eslint-disable-next-line spaced-comment\n///<reference types=\"webpack-env\" />\n// We expect __webpack_public_path__ to be present, thanks to webpack\n// We are not using DOM in the typescript library, so let's just hack our way\n// through window\n// tslint:disable-next-line:no-any\n// We would override __webpack_public_path__ only if __WPACKIO__ webpack plugin is set\nif(__WPACKIO__){var path=(__WPACKIO__.appName+__WPACKIO__.outputPath).replace(/[^a-zA-Z0-9_-]/g,'');// eslint-disable-next-line no-global-assign\n__webpack_public_path__=window[\"__wpackIo\".concat(path)];}","/* global jQuery, ajaxurl, focalPointL10n */\n(function($, win, doc) {\n\tfunction maxRange(val1, val2, val3) {\n\t\tlet result = val1;\n\n\t\tif (val1 < val2) {\n\t\t\tresult = val2;\n\t\t} else if (val1 > val3) {\n\t\t\tresult = val3;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tconst CLASSES = {\n\t\tIMAGE_FOCAL          : 'image-focal',\n\t\tIMAGE_FOCAL_WRAPPER  : 'image-focal__wrapper',\n\t\tIMAGE_FOCAL_IMG      : 'image-focal__img',\n\t\tIMAGE_FOCAL_POINT    : 'image-focal__point',\n\t\tIMAGE_FOCAL_CLICKAREA: 'image-focal__clickarea',\n\t\tIMAGE_FOCAL_BUTTON   : 'image-focal__button',\n\t\tBUTTON               : 'button',\n\t\tBUTTON_PRIMARY       : 'button-primary',\n\t\tBUTTON_DISABLED      : 'button-disabled'\n\t};\n\n\t$.imageFocal = $.imageFocal || {};\n\n\t$.imageFocal.focalPoint = function(el, options) {\n\t\tconst self = this;\n\n\t\tself.$el = $(el);\n\t\tself.el = el;\n\t\tself.$el.data('imageFocal.focalPoint', self);\n\n\t\tlet $imageFocal;\n\t\tlet $clickArea;\n\n\t\tself.init = function() {\n\t\t\tself.options = $.extend({}, $.imageFocal.focalPoint.defaultOptions, options);\n\n\t\t\tself.addInterfaceElements();\n\t\t\tself.attachment.init();\n\t\t\tself.focusInterface.init();\n\t\t\tself.saveButton.init();\n\n\t\t\t$(doc).on('resize', self.attachment.updateDimensionData);\n\t\t};\n\n\t\tself.addInterfaceElements = function() {\n\t\t\tconst $el = $('.edit-attachment-frame .attachment-media-view .details-image, .edit-attachment-frame .image-editor .imgedit-crop-wrap img');\n\n\t\t\t$el.addClass(CLASSES.IMAGE_FOCAL_IMG);\n\t\t\t$el.wrap(`<div class=\"${CLASSES.IMAGE_FOCAL}\"><div class=\"${CLASSES.IMAGE_FOCAL_WRAPPER}\"></div></div>`);\n\n\t\t\tconst $focalWrapper = $(`.${CLASSES.IMAGE_FOCAL_WRAPPER}`);\n\n\t\t\t$focalWrapper.append(`<div class=\"${CLASSES.IMAGE_FOCAL_POINT}\"></div>`);\n\t\t\t$focalWrapper.append(`<div class=\"${CLASSES.IMAGE_FOCAL_CLICKAREA}\"></div>`);\n\n\t\t\t$imageFocal = $(`.${CLASSES.IMAGE_FOCAL}`);\n\t\t\t$clickArea = $(`.${CLASSES.IMAGE_FOCAL_CLICKAREA}`);\n\t\t};\n\n\t\tself.attachment = {\n\t\t\t$el   : false,\n\t\t\tid    : false,\n\t\t\twidth : false,\n\t\t\theight: false,\n\t\t\toffset: {\n\t\t\t\tx: false,\n\t\t\t\ty: false\n\t\t\t},\n\t\t\tfocalPoint: {\n\t\t\t\tx: 50,\n\t\t\t\ty: 50\n\t\t\t},\n\t\t\tinit() {\n\t\t\t\tself.attachment.$el = $(`.${CLASSES.IMAGE_FOCAL_IMG}`);\n\t\t\t\tself.attachment.getData();\n\t\t\t\tself.attachment.$el.load(() => {\n\t\t\t\t\tself.attachment.updateDimensionData();\n\t\t\t\t});\n\t\t\t},\n\t\t\tgetData() {\n\t\t\t\tself.attachment.id = $(self.el).find('#attachment-id').data('id');\n\n\t\t\t\tconst attachment = {\n\t\t\t\t\t'id': self.attachment.id\n\t\t\t\t};\n\n\t\t\t\t$.ajax({\n\t\t\t\t\ttype: 'POST',\n\t\t\t\t\turl : ajaxurl,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taction: 'get_focal_point',\n\t\t\t\t\t\tattachment\n\t\t\t\t\t},\n\t\t\t\t\tdataType: 'json'\n\t\t\t\t}).always(result => {\n\t\t\t\t\tif (result['success'] === true && result['data'] && result['data']['focal_point']) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (result['data']['focal_point']['x'] === undefined || result['data']['focal_point']['y'] === undefined) {\n\t\t\t\t\t\t\t\tthrow new Error('no coordinates');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tself.attachment.focalPoint = result['data']['focal_point'];\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tself.attachment.updateDimensionData();\n\t\t\t\t\tself.focusInterface.updateStylePosition();\n\t\t\t\t\tself.focusInterface.$el.css({\n\t\t\t\t\t\tdisplay: 'block'\n\t\t\t\t\t});\n\t\t\t\t\tself.focusInterface.updateDimensionData();\n\t\t\t\t\tself.focusInterface.updateStyleBackground();\n\t\t\t\t});\n\t\t\t},\n\t\t\tupdateDimensionData() {\n\t\t\t\tconst $el = self.attachment.$el;\n\n\t\t\t\tself.attachment.width = $el.width();\n\t\t\t\tself.attachment.height = $el.height();\n\t\t\t\tself.attachment.offset.x = $el.offset().left;\n\t\t\t\tself.attachment.offset.y = $el.offset().top;\n\t\t\t}\n\t\t};\n\n\t\tself.focusInterface = {\n\t\t\t$el   : false,\n\t\t\twidth : 0,\n\t\t\theight: 0,\n\t\t\tradius: 0,\n\t\t\toffset: {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0\n\t\t\t},\n\t\t\tposition: {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0\n\t\t\t},\n\t\t\tclickPosition: {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0\n\t\t\t},\n\t\t\tstate: {\n\t\t\t\tmove  : false,\n\t\t\t\tactive: false,\n\t\t\t\thover : false\n\t\t\t},\n\t\t\tinit() {\n\t\t\t\tself.focusInterface.$el = $(`.${CLASSES.IMAGE_FOCAL_POINT}`);\n\n\t\t\t\t$clickArea.on('mousedown', e => {\n\t\t\t\t\tif (e.which === 1) {\n\t\t\t\t\t\tself.focusInterface.startMove(e, true).move(e);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.focusInterface.$el\n\t\t\t\t\t.on('mousedown', e => {\n\t\t\t\t\t\tif (e.which === 1) {\n\t\t\t\t\t\t\tself.focusInterface.startMove(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('mouseenter', () => {\n\t\t\t\t\t\tself.focusInterface.hover(true);\n\t\t\t\t\t})\n\t\t\t\t\t.on('mouseleave', () => {\n\t\t\t\t\t\tself.focusInterface.hover(false);\n\t\t\t\t\t});\n\n\t\t\t\t$(win)\n\t\t\t\t\t.on('mouseup', e => {\n\t\t\t\t\t\tif (e.which === 1) {\n\t\t\t\t\t\t\tself.focusInterface.state.move = false;\n\t\t\t\t\t\t\tself.focusInterface.state.active = false;\n\t\t\t\t\t\t\t$imageFocal.removeClass('is-active');\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('mousemove', e => {\n\t\t\t\t\t\tself.focusInterface.move(e);\n\t\t\t\t\t})\n\t\t\t\t\t.on('resize', () => {\n\t\t\t\t\t\tself.focusInterface.updateDimensionData().updateStyle();\n\t\t\t\t\t});\n\t\t\t},\n\t\t\tstartMove(t, e) {\n\t\t\t\tself.attachment.updateDimensionData();\n\t\t\t\tself.focusInterface.updateDimensionData().updateClickPosition(t, e);\n\t\t\t\tself.saveButton.highlight();\n\n\t\t\t\t$imageFocal.addClass('is-active');\n\n\t\t\t\tself.focusInterface.state.move = true;\n\t\t\t\tself.focusInterface.state.active = true;\n\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tmove(e) {\n\t\t\t\tif (self.focusInterface.state.move === false) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst a = {};\n\t\t\t\tconst offset = self.attachment.offset;\n\t\t\t\tconst pos = self.focusInterface.clickPosition;\n\n\t\t\t\ta.x = e.pageX - offset.x - pos.x;\n\t\t\t\ta.y = e.pageY - offset.y - pos.y;\n\t\t\t\ta.x = maxRange(a.x, 0, self.attachment.width);\n\t\t\t\ta.y = maxRange(a.y, 0, self.attachment.height);\n\n\t\t\t\tself.attachment.focalPoint = {\n\t\t\t\t\tx: a.x / self.attachment.width * 100,\n\t\t\t\t\ty: a.y / self.attachment.height * 100\n\t\t\t\t};\n\n\t\t\t\tself.focusInterface.position = a;\n\t\t\t\tself.focusInterface.updateStyle();\n\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tupdateStyle() {\n\t\t\t\tself.focusInterface.updateStylePosition();\n\t\t\t\tself.focusInterface.updateStyleBackground();\n\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tupdateStylePosition() {\n\t\t\t\tself.focusInterface.$el.css({\n\t\t\t\t\tleft: `${self.attachment.focalPoint.x}%`,\n\t\t\t\t\ttop : `${self.attachment.focalPoint.y}%`\n\t\t\t\t});\n\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tupdateStyleBackground() {\n\t\t\t\tconst x = 0 - (self.focusInterface.position.x - self.focusInterface.radius);\n\t\t\t\tconst y = 0 - (self.focusInterface.position.y - self.focusInterface.radius);\n\n\t\t\t\tself.focusInterface.$el.css({\n\t\t\t\t\tbackgroundImage   : `url(\"${self.attachment.$el.attr('src')}\")`,\n\t\t\t\t\tbackgroundSize    : `${self.attachment.width}px ${self.attachment.height}px`,\n\t\t\t\t\tbackgroundPosition: `${x}px ${y}px `\n\t\t\t\t});\n\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tupdateClickPosition(t, e) {\n\t\t\t\tconst pos = {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0\n\t\t\t\t};\n\n\t\t\t\tif (e !== true) {\n\t\t\t\t\tconst o = self.focusInterface.offset;\n\n\t\t\t\t\tpos.x = t.pageX - o.x;\n\t\t\t\t\tpos.y = t.pageY - o.y;\n\t\t\t\t}\n\n\t\t\t\tself.focusInterface.clickPosition = pos;\n\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tupdateDimensionData() {\n\t\t\t\tself.focusInterface.width = self.focusInterface.$el.width();\n\t\t\t\tself.focusInterface.height = self.focusInterface.$el.height();\n\n\t\t\t\tconst radius = self.focusInterface.width / 2;\n\n\t\t\t\tself.focusInterface.radius = radius;\n\n\t\t\t\tconst o = self.focusInterface.$el.offset();\n\n\t\t\t\tself.focusInterface.offset = {\n\t\t\t\t\tx: o.left + radius,\n\t\t\t\t\ty: o.top + radius\n\t\t\t\t};\n\n\t\t\t\tself.focusInterface.position = {\n\t\t\t\t\tx: self.attachment.focalPoint.x / 100 * self.attachment.width,\n\t\t\t\t\ty: self.attachment.focalPoint.y / 100 * self.attachment.height\n\t\t\t\t};\n\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\thover(val) {\n\t\t\t\tself.focusInterface.state.hover = val;\n\n\t\t\t\t$imageFocal.toggleClass('is-hover', val);\n\t\t\t}\n\t\t};\n\n\t\tself.saveButton = {\n\t\t\t$el     : false,\n\t\t\tisSaving: false,\n\t\t\tinit() {\n\t\t\t\tconst button = `<button type=\"button\" class=\"${CLASSES.BUTTON} ${CLASSES.BUTTON_DISABLED} crop-attachment ${CLASSES.IMAGE_FOCAL_BUTTON}\">${focalPointL10n.saveButton}</button>`;\n\n\t\t\t\t$(self.el)\n\t\t\t\t\t.find('.attachment-actions, .imgedit-submit')\n\t\t\t\t\t.append(button);\n\n\t\t\t\tself.saveButton.$el = $(`.${CLASSES.IMAGE_FOCAL_BUTTON}`);\n\t\t\t\tself.saveButton.$el.on('click', self.sendImageCropDataByAjax);\n\t\t\t},\n\t\t\thighlight() {\n\t\t\t\tself.saveButton.$el\n\t\t\t\t\t.removeClass(CLASSES.BUTTON_DISABLED)\n\t\t\t\t\t.addClass(CLASSES.BUTTON_PRIMARY)\n\t\t\t\t\t.text(focalPointL10n.saveButton);\n\t\t\t},\n\t\t\tactivate() {\n\t\t\t\tself.saveButton.$el\n\t\t\t\t\t.removeClass(CLASSES.BUTTON_DISABLED)\n\t\t\t\t\t.removeClass(CLASSES.BUTTON_PRIMARY);\n\t\t\t},\n\t\t\tdisable() {\n\t\t\t\tself.saveButton.$el\n\t\t\t\t\t.removeClass(CLASSES.BUTTON_PRIMARY)\n\t\t\t\t\t.addClass(CLASSES.BUTTON_DISABLED);\n\t\t\t}\n\t\t};\n\n\t\tself.sendImageCropDataByAjax = function() {\n\t\t\tconst attachment = {\n\t\t\t\t'id'         : self.attachment.id,\n\t\t\t\t'focal_point': self.attachment.focalPoint\n\t\t\t};\n\n\t\t\t$.ajax({\n\t\t\t\ttype: 'POST',\n\t\t\t\turl : ajaxurl,\n\t\t\t\tdata: {\n\t\t\t\t\taction: 'set_focal_point',\n\t\t\t\t\tattachment\n\t\t\t\t},\n\t\t\t\tdataType: 'json',\n\t\t\t\tbeforeSend() {\n\t\t\t\t\tif (self.saveButton.isSaving === true) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tself.saveButton.$el.text(focalPointL10n.saving);\n\t\t\t\t\tself.saveButton.disable();\n\t\t\t\t\tself.saveButton.isSaving = true;\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}).always(result => {\n\t\t\t\tlet msg = focalPointL10n.saved;\n\n\t\t\t\tif (result.success !== true) {\n\t\t\t\t\tself.saveButton.activate();\n\t\t\t\t\tmsg = focalPointL10n.tryAgain;\n\t\t\t\t}\n\n\t\t\t\tself.saveButton.$el.text(msg);\n\t\t\t\tself.saveButton.isSaving = false;\n\t\t\t});\n\t\t};\n\t};\n\n\t$.imageFocal.focalPoint.defaultOptions = {\n\t\tmyDefaultValue: ''\n\t};\n\n\t$.fn.initFocalPoint = function(options) {\n\t\treturn this.each(function() {\n\t\t\tconsole.log('initFocalPoint', this);\n\t\t\tnew $.imageFocal.focalPoint(this, options).init();\n\t\t});\n\t};\n\n\t$(doc).on('ready', () => {\n\t\twin.setInterval(() => {\n\t\t\tconst $el = $('.attachment-details, .image-editor');\n\n\t\t\tif ($el.find('.details-image, .imgedit-crop-wrap img').length && !$('.image-focal').length) {\n\t\t\t\ttry {\n\t\t\t\t\t$el.initFocalPoint();\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.log(err);\n\t\t\t\t}\n\t\t\t}\n\t\t}, 500);\n\t});\n})(jQuery, window, document);\n"],"sourceRoot":""}